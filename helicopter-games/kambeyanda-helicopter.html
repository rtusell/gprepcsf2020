<html>
<head>

	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

	<title>Kambeyanda Helicopter</title>
	
	<link rel="stylesheet" type="text/css" href="../style.css">
	
	<script type="text/javascript" src="https://static.codehs.com/gulp/0444eb492be7b35724333daa087b82121c1743cb/chs-js-lib/chs.js"></script>


	<style>
	canvas 
	{
	    border: 1px solid black;
	    display: block;
		margin-left:auto;
		margin-right:auto;
	    vertical-align: top;
	}
	
	pre 
	{
	    border: 1px solid black;
	    display: inline-block;
	    width: 400px;
	    height: 500px;
	    background-color: #F5F5F5;
	}
	</style>

</head>

<body>
	<div class="container">
		<br>
		<br>
		<div class="row">
			<img  class="logo" src = "https://www.gprep.org/uploaded/Website_Redesign_Spring_2016/seal_PMS_282_blue.jpg" width ="200 px">
		</div>
		<br>
		<div class="row">
			<h1 class="text-center">
	            Computer Science Fundamentals
				<br>
				<small>Summer 2020</small>
	        </h1>
		</div>
		<div class="btn-group btn-group-justified">
			<a href="../index.html" class="btn btn-primary btn-lg"> <span class="glyphicon glyphicon-home"></span> Home </a>
			<a href="../helicopter.html" class="btn btn-primary btn-lg"> Helicopter </a>
			<a href="../tic-tac-toe.html" class="btn btn-primary btn-lg">Tic-tac-toe</a>
			<a href="../break-out.html" class="btn btn-primary btn-lg">Breakout</a>
			<a href="../snake.html" class="btn btn-primary btn-lg">Snake</a>
		</div>
		<div class="spacer"></div>
		<canvas 
		width="400"
		height="500"
		class="displaygame"></canvas>
		
		<script>
		window.onload = function() {
		
		var DELAY = 40;
		var SPEED = 5;
		var MAX_DY = 12;
		
		var copter;
		var dy = 0;
		
		var OBSTACLE_WIDTH = 30;
		var OBSTACLE_HEIGHT = 100;
		
		var clicking = false;
		
		var TERRAIN_WIDTH = 10;
		var MIN_TERRAIN_HEIGHT = 20;
		var MAX_TERRAIN_HEIGHT = 50;
		
		var top_terrain = [];
		var bottom_terrain = [];
		
		var points = 0;
		var score;
		
		var POINTS_PER_ROUND = 5;
		
		var DUST_RADIUS = 3;
		var DUST_BUFFER = 10;  
		
		var dust = [];
		var obstacles = [];
		
		var NUM_OBSTACLES = 3;
		
		function start(){
			setup();
			setTimer(game, DELAY);
			mouseDownMethod(onMouseDown);
			mouseUpMethod(onMouseUp);
		}
		
		function setup(){
		    setBackgroundColor(Color.black);
		    copter = new WebImage("https://gprepcsf2020.com/images/helicopter.png");
		    copter.setSize(50,25);
		    copter.setPosition(getWidth()/3,getHeight()/2);
		    copter.setColor(Color.blue);
		    add(copter);
		    
		    addObstacles();
		    addTerrain();
		    
		    score = new Text("0");
		    score.setColor(Color.white);
		    score.setPosition(10,30);
		    add(score);
		}
		
		function updateScore(){
		    points += POINTS_PER_ROUND;
		    score.setText(points);
		}
		
		function game(){
		    updateScore();
		    if(hitWall()){
		        lose();
		        return;
		    }
		    var collider = getCollider();
		    if(collider != null && collider != copter){
		        lose();
		        return;
		    }
		    if(clicking){
		        dy -= 1;
		        if(dy < -MAX_DY) {
		            dy = -MAX_DY;
		        }
		    }
		    else
		    {
		        dy += 1;
		        if(dy>MAX_DY){
		            dy = MAX_DY;
		        }
		    }
		    copter.move (0,dy);
		    moveObstacles();
		    moveTerrain();
		    moveDust();
		    addDust();
		 
		}
		
		function onMouseDown(e){
		    clicking = true;
		}
		
		function onMouseUp(e){
		    clicking = false;
		}
		
		function addObstacles(){
		    for(var i = 0 ; i<NUM_OBSTACLES; i++){
		    
		        var obstacle = new Rectangle(OBSTACLE_WIDTH, OBSTACLE_HEIGHT);
		        obstacle.setColor(Color.green);
		        obstacle.setPosition(getWidth() + i * (getWidth()/NUM_OBSTACLES) ,
		                        Randomizer.nextInt(0,getHeight()-OBSTACLE_HEIGHT));
		        obstacles.push(obstacle);
		        add(obstacle);
		    }
		}
		
		function moveObstacles(){
		   for(var i = 0 ; i < obstacles.length ; i++){
		   var obstacle = obstacles[i];
		   obstacle.move(-SPEED,0);
		   if(obstacle.getX() < 0){
		        obstacle.setPosition(getWidth(),
		                            Randomizer.nextInt(0,getHeight()-OBSTACLE_HEIGHT));
		   }
		  }
		}
		
		function hitWall(){
		    var hitTop = copter.getY()<0;
		    var hitBottom = copter.getY() + copter.getHeight() > getHeight();
		    return hitTop || hitBottom;
		}
		
		function lose(){
		    stopTimer(game);
		    var txt = new Text("You lose");
		    txt.setColor(Color.red);
		    txt.setPosition(getWidth()/2 - txt.getWidth()/2 ,getHeight()/2);
		    add(txt);
		}
		
		function getCollider(){
		    var topLeft = getElementAt(copter.getX() -1 ,copter.getY() -1);
		    if(topLeft != null){
		        return topLeft;
		    }
		    var topRight = getElementAt(copter.getX() + copter.getWidth() + 1 , copter.getY()-1 );
		    if(topRight != null){
		        return topRight;
		    }
		    
		    var bottomLeft = getElementAt(copter.getX()-1 , copter.getY() + copter.getHeight() + 1);
		    if(bottomLeft != null){
		        return bottomLeft;
		    }
		    
		    var bottomRight = getElementAt(copter.getX() + copter.getWidth() + 1 , copter.getY() + copter.getHeight()+1);
		    if(bottomRight != null){
		        return bottomRight;
		    }
		    
		    return null;
		}
		
		function addTerrain(){
		    for(var i = 0; i<= getWidth()/TERRAIN_WIDTH; i++){
		        var HEIGHT = Randomizer.nextInt(MIN_TERRAIN_HEIGHT, MAX_TERRAIN_HEIGHT)
		        var terrain = new Rectangle(TERRAIN_WIDTH,HEIGHT)
		        terrain.setPosition(TERRAIN_WIDTH*i,0);
		        terrain.setColor(Color.red);
		        top_terrain.push(terrain);
		        add(terrain);
		        
		        HEIGHT = Randomizer.nextInt(MIN_TERRAIN_HEIGHT, MAX_TERRAIN_HEIGHT)
		        var bottomTerrain = new Rectangle(TERRAIN_WIDTH,HEIGHT)
		        bottomTerrain.setPosition(TERRAIN_WIDTH*i, getHeight()-bottomTerrain.getHeight());
		        bottomTerrain.setColor(Color.red);
		        bottom_terrain.push(bottomTerrain);
		        add(bottomTerrain);
		    }
		}
		
		function moveTerrain(){
		    for(var i = 0 ; i < top_terrain.length ; i++){
		        var obj = top_terrain[i];
		        obj.move(-SPEED,0);
		        if(obj.getX()< -obj.getWidth()){
		            obj.setPosition(getWidth(),0);
		        }
		    }
		    
		     for(var i = 0 ; i < bottom_terrain.length ; i++){
		        var obj = bottom_terrain[i];
		        obj.move(-SPEED,0);
		        if(obj.getX()< -obj.getWidth()){
		            obj.setPosition(getWidth(), getHeight() - obj.getHeight());
		        }
		    }
		}
		
		function addDust(){
		    var d = new Circle(DUST_RADIUS);
		    d.setColor("#cccccc");
		    d.setPosition(copter.getX()-d.getWidth(), copter.getY() + DUST_BUFFER);
		    dust.push(d);
		    add(d);
		}
		
		function moveDust(){
		    for(var i = 0 ; i < dust.length; i++ ){
		        var d = dust [i];
		        d.move(-SPEED,0);
		        d.setRadius(d.getRadius()-0.1);
		        if(d.getX()<0){
		            remove(d);
		            dust.remove(i);
		            i--;
		        }
		    }
		}
				
			if (typeof start === 'function') {
			        start();
			}
		};
		</script>
		<br>
		<div class="spacer"></div>
	</div>
	</body>
</html>
